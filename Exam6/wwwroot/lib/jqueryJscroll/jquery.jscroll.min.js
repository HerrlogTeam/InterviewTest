/*!
 * jScroll - jQuery Plugin for Infinite Scrolling / Auto-Paging
 * @see @link{https://jscroll.com}
 *
 * @copyright Philip Klauzinski
 * @license Dual licensed under the MIT and GPL Version 2 licenses
 * @author Philip Klauzinski (https://webtopian.com)
 * @version 2.4.1
 * @requires jQuery v1.8.0+
 * @preserve
 */
(function(n){"use strict";n.jscroll={defaults:{debug:!1,autoTrigger:!0,autoTriggerUntil:!1,loadingHtml:"<small>Loading...<\/small>",loadingFunction:!1,padding:0,nextSelector:"a:last",contentSelector:"",pagingSelector:"",callback:!1}};var t=function(t,i){var s=t.data("jscroll"),p=typeof i=="function"?{callback:i}:i,r=n.extend({},n.jscroll.defaults,p,s||{}),h=t.css("overflow-y")==="visible",w=t.find(r.nextSelector).first(),f=n(window),b=n("body"),u=h?f:t,k=n.trim(w.prop("href")+" "+r.contentSelector),d=function(){var t=n(r.loadingHtml).filter("img").attr("src"),i;t&&(i=new Image,i.src=t)},c=function(){t.find(".jscroll-inner").length||t.contents().wrapAll('<div class="jscroll-inner" />')},l=function(n){var t;r.pagingSelector?n.closest(r.pagingSelector).hide():(t=n.parent().not(".jscroll-inner,.jscroll-added").addClass("jscroll-next-parent").hide(),t.length||n.wrap('<div class="jscroll-next-parent" />').parent().hide())},e=function(){return u.unbind(".jscroll").removeData("jscroll").find(".jscroll-inner").children().unwrap().filter(".jscroll-added").children().unwrap()},a=function(){if(t.is(":visible")){c();var n=t.find("div.jscroll-inner").first(),e=t.data("jscroll"),i=parseInt(t.css("borderTopWidth"),10),s=isNaN(i)?0:i,l=parseInt(t.css("paddingTop"),10)+s,a=h?u.scrollTop():t.offset().top,v=n.length?n.offset().top:0,f=Math.ceil(a-v+u.height()+l);if(!e.waiting&&f+r.padding>=n.outerHeight())return o("info","jScroll:",n.outerHeight()-f,"from bottom. Loading next request..."),y()}},g=function(n){return n=n||t.data("jscroll"),n&&n.nextHref?(v(),!0):(o("warn","jScroll: nextSelector not found - destroying"),e(),!1)},v=function(){var i=t.find(r.nextSelector).first();if(i.length)if(r.autoTrigger&&(r.autoTriggerUntil===!1||r.autoTriggerUntil>0)){l(i);var e=b.height()-t.offset().top,o=t.height()<e?t.height():e,s=t.offset().top-f.scrollTop()>0?f.height()-(t.offset().top-n(window).scrollTop()):f.height();o<=s&&a();u.unbind(".jscroll").bind("scroll.jscroll",function(){return a()});r.autoTriggerUntil>0&&r.autoTriggerUntil--}else u.unbind(".jscroll"),i.bind("click.jscroll",function(){return l(i),y(),!1})},y=function(){var u=t.find("div.jscroll-inner").first(),i=t.data("jscroll");return i.waiting=!0,u.append('<div class="jscroll-added" />').children(".jscroll-added").last().html('<div class="jscroll-loading" id="jscroll-loading">'+r.loadingHtml+"<\/div>").promise().done(function(){r.loadingFunction&&r.loadingFunction()}),t.animate({scrollTop:u.outerHeight()},0,function(){var f=i.nextHref;u.find("div.jscroll-added").last().load(f,function(u,s){if(s==="error")return e();var h=n(this).find(r.nextSelector).first();i.waiting=!1;i.nextHref=h.prop("href")?n.trim(h.prop("href")+" "+r.contentSelector):!1;n(".jscroll-next-parent",t).remove();g();r.callback&&r.callback.call(this,f);o("dir",i)})})},o=function(n){var i,t;if(r.debug&&typeof console=="object"&&(typeof n=="object"||typeof console[n]=="function"))if(typeof n=="object"){i=[];for(t in n)typeof console[t]=="function"?(i=n[t].length?n[t]:[n[t]],console[t].apply(console,i)):console.log.apply(console,i)}else console[n].apply(console,Array.prototype.slice.call(arguments,1))};return t.data("jscroll",n.extend({},s,{initialized:!0,waiting:!1,nextHref:k})),c(),d(),v(),n.extend(t.jscroll,{destroy:e}),t};n.fn.jscroll=function(i){return this.each(function(){var r=n(this),u=r.data("jscroll");u&&u.initialized||t(r,i)})}})(jQuery);